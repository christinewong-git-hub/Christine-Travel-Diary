<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…è¡Œè¨ˆç•«æ›¸ - è¡Œç¨‹èˆ‡åœ°åœ– (Day X æŠ˜ç–Š)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20n6a958FgpB4mG8Xg2nP3k8uW8kUfWz9c/QD8CB6w=" crossorigin=""></script>
    
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4F46E5', // Indigo-600
                        'secondary': '#10B981', // Emerald-500
                    },
                    keyframes: {
                        'slide-down': {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    },
                    animation: {
                        'fade-in': 'slide-down 0.5s ease-out',
                        'slide-down-quick': 'slide-down 0.3s ease-out',
                    }
                }
            }
        }
    </script>

    <style>
        /* Hide scrollbar for the custom class */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom card style */
        .glass-card {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 28px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen p-4">

    <div id="app" class="max-w-3xl mx-auto font-sans">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">æˆ‘çš„æ—…è¡Œè¨ˆç•«æ›¸</h1>
        
        <nav class="flex space-x-2 border-b mb-6 sticky top-0 bg-gray-50/95 backdrop-blur-sm z-20 pt-2 pb-1 -mx-4 px-4">
            <button 
                @click="activeTab = 'itinerary-map'"
                :class="{'bg-primary text-white shadow-md': activeTab === 'itinerary-map', 'text-gray-600': activeTab !== 'itinerary-map'}"
                class="px-5 py-2.5 text-sm font-medium rounded-t-xl transition"
            >
                è¡Œç¨‹èˆ‡åœ°åœ–
            </button>
            <button 
                @click="activeTab = 'other'"
                :class="{'bg-primary text-white shadow-md': activeTab === 'other', 'text-gray-600': activeTab !== 'other'}"
                class="px-5 py-2.5 text-sm font-medium rounded-t-xl transition"
            >
                å…¶ä»–è³‡è¨Š (Demo)
            </button>
        </nav>

        <section v-if="activeTab === 'itinerary-map' && activeTrip" class="animate-fade-in">
  
            <div class="sticky top-[70px] bg-white/95 backdrop-blur-sm z-10 p-4 -mx-4">
                <div class="glass-card p-3 mb-3 flex items-center justify-between">
                    <label for="total-days" class="text-sm font-semibold text-slate-600 flex items-center gap-2">
                        <i class="ri-calendar-2-line text-lg text-primary"></i>æ—…è¡Œç¸½æ—¥æ•¸ (Day 1 - Day X)
                    </label>
                    <input 
                        id="total-days"
                        v-model.number="totalTripDays" 
                        type="number" 
                        min="1" 
                        @change="reorganizeItinerary; saveData()" 
                        class="w-20 text-center font-bold text-lg bg-slate-50 border-0 rounded-xl focus:ring-primary/50"
                    >
                </div>

                <div class="flex gap-3 overflow-x-auto pb-2 scrollbar-hide">
                    <button @click="addItineraryItem" class="flex-shrink-0 bg-primary text-white px-5 py-3 rounded-2xl text-sm font-bold shadow-lg shadow-blue-200 hover:shadow-xl transition active:scale-95 flex items-center gap-2">
                        <i class="ri-add-circle-fill text-lg"></i>æ–°å¢è¡Œç¨‹é …ç›®
                    </button>
                    <button @click="showBatchImport = !showBatchImport" class="flex-shrink-0 bg-white text-slate-600 px-5 py-3 rounded-2xl text-sm font-bold shadow-sm border border-slate-100 flex items-center gap-2">
                        <i class="ri-file-list-3-line text-lg"></i>æ‰¹æ¬¡åŒ¯å…¥
                    </button>
                    <button @click="drawAllDayRoutes" class="flex-shrink-0 bg-white text-slate-600 px-5 py-3 rounded-2xl text-sm font-bold shadow-sm border border-slate-100 flex items-center gap-2">
                        <i class="ri-route-line text-lg"></i>é‡ç¹ªè·¯ç·š
                    </button>
                </div>
            </div>

            <div v-if="showBatchImport" class="glass-card p-4 mb-4 animate-slide-down-quick">
                <textarea v-model="batchImportText" placeholder="è²¼ä¸Šåœ°é»æ¸…å–® (æ ¼å¼: æ™‚é–“, æ´»å‹•, åœ°åœ–é€£çµ URL) ..." class="w-full h-32 p-3 rounded-xl bg-slate-50 border-0 text-sm mb-3 focus:ring-2 ring-primary/50"></textarea>
                <button @click="runBatchImport" class="w-full bg-secondary text-white py-2 rounded-xl font-medium">é–‹å§‹åŒ¯å…¥</button>
            </div>

            <div class="pb-24 space-y-8 mt-4">
                <div v-for="(dayItems, dayIdx) in groupedItinerary" :key="dayIdx" class="glass-card p-1">
                
                    <button @click="toggleDayVisibility(dayIdx)" class="w-full text-left p-4 rounded-t-[22px] border-b border-slate-100 flex justify-between items-center transition bg-slate-50/50 hover:bg-slate-100 active:bg-slate-200">
                        <span class="bg-primary text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-md shadow-primary/30 flex items-center gap-2">
                            <i :class="dayVisibility[dayIdx] ? 'ri-arrow-down-s-line' : 'ri-arrow-right-s-line'" class="text-lg"></i>
                            Day {{ dayIdx + 1 }}
                        </span>
                        <span class="text-xs text-slate-400 font-bold tracking-wider">{{ dayItems.length }} å€‹æ™¯é»</span>
                    </button>
                    
                    <div v-show="dayVisibility[dayIdx]" class="animate-slide-down-quick">
                        <div class="p-4 space-y-6">
                            <div v-if="dayItems.length === 0" class="text-center text-slate-400 py-4 text-sm">
                                æœ¬å¤©å°šç„¡è¡Œç¨‹ï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•æ–°å¢ã€‚
                            </div>

                            <div v-for="(item, idx) in dayItems" :key="item.id" class="relative pl-6 border-l-2 border-slate-200">
                                <div class="absolute -left-[9px] top-1 w-4 h-4 rounded-full bg-white border-4 border-slate-300"></div>
                                
                                <div class="flex justify-between items-start mb-1">
                                    <input v-model="item.time" type="time" @change="saveData" class="bg-transparent font-bold text-lg text-slate-700 w-24 p-0 border-0 focus:ring-0">
                                    <button @click="removeItineraryItemByDay(dayIdx, item.id)" class="text-slate-300 hover:text-red-400"><i class="ri-close-circle-fill text-xl"></i></button>
                                </div>
                                
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="ri-sun-line text-sm text-secondary"></i>
                                    <span class="text-xs text-slate-500">æ‰€å±¬ Dayï¼š</span>
                                    <select v-model.number="item.day" @change="reorganizeItinerary; saveData()" class="text-sm font-medium border-0 bg-slate-100 rounded-lg py-1 px-2 focus:ring-0">
                                        <option v-for="d in totalTripDays" :key="d" :value="d">Day {{ d }}</option>
                                    </select>
                                </div>

                                <input v-model="item.activity" placeholder="è¡Œç¨‹æ¦‚è¦ / å‚™è¨»" @change="saveData" class="w-full font-bold text-lg text-slate-800 bg-transparent mb-1 border-0 border-b border-transparent focus:border-primary focus:ring-0 placeholder-slate-300 p-0 transition">
                                
                                <div class="flex items-center gap-2 mb-3">
                                    <i class="ri-link text-primary flex-shrink-0"></i>
                                    <input v-model="item.mapLink" placeholder="è²¼ä¸Š Google/OSM Maps URL (å¿…é ˆåŒ…å« @åº§æ¨™)" @change="saveData" class="w-full text-sm text-slate-500 bg-transparent border-0 focus:ring-0 p-0">
                                </div>
                                
                                <div v-if="idx === 0" :id="mapId(item, dayIdx, idx)" class="w-full h-40 mt-3 rounded-lg bg-slate-100 shadow-inner"></div>
                                
                                <div class="flex gap-2 mt-3">
                                    <button @click="openMapLink(item)" class="flex-1 bg-white border border-slate-200 py-2 rounded-xl text-xs font-bold text-slate-600 hover:bg-slate-50 transition flex items-center justify-center gap-1">
                                        <i class="ri-external-link-line"></i> Open Link
                                    </button>
                                </div>
                            </div>
                            
                            <button @click="addItineraryItemToDay(dayIdx + 1)" class="w-full mt-4 bg-slate-100 text-slate-500 py-2 rounded-xl text-sm font-medium hover:bg-slate-200 transition">
                                <i class="ri-add-line"></i> æ–°å¢ Day {{ dayIdx + 1 }} è¡Œç¨‹
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section v-if="activeTab === 'other'" class="animate-fade-in glass-card p-6">
            <h2 class="text-xl font-semibold mb-3">å…¶ä»–è³‡è¨Šé é¢</h2>
            <p class="text-slate-600">æ­¤é é¢åƒ…ç‚ºå±•ç¤ºç”¨ã€‚</p>
        </section>

    </div>

    <script>
        // ç”¨æ–¼ç”Ÿæˆç¨ç‰¹çš„è¡Œç¨‹ ID
        let nextItemId = 1; 

        const { createApp, ref, computed, watch, nextTick } = Vue;

        createApp({
            data() {
                return {
                    activeTab: 'itinerary-map',
                    activeTrip: null,
                    showBatchImport: false,
                    batchImportText: '',
                    
                    // ğŸ¯ æ ¸å¿ƒ data
                    totalTripDays: 3, 
                    dayVisibility: { 0: true }, // é è¨­ Day 1 (index 0) å±•é–‹
                    
                    // åœ°åœ–ç›¸é—œ
                    dayMaps: {},
                    dayPolylines: {},
                    dayMarkers: {},
                    polylineColors: ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#06B6D4'], // è·¯ç·šé¡è‰²
                };
            },

            mounted() {
                this.loadData();
            },

            computed: {
                activeTrip() {
                    // é€™è£¡å¯ä»¥æ ¹æ“šå¯¦éš›æ‡‰ç”¨ä¸­çš„ ID è¼‰å…¥å°æ‡‰çš„æ—…è¡Œ
                    // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘ç›´æ¥ä½¿ç”¨æ¨¡æ“¬è³‡æ–™
                    return this.activeTripData;
                },

                // ğŸ¯ æ ¸å¿ƒè®Šå‹•ï¼šæ ¹æ“š totalTripDays å’Œ item.day å±¬æ€§ä¾†åˆ†çµ„è¡Œç¨‹
                groupedItinerary() {
                    if (!this.activeTrip || !this.activeTrip.itinerary || this.totalTripDays < 1) {
                        // å¦‚æœæ²’æœ‰è¡Œç¨‹æˆ–å¤©æ•¸ï¼Œå‰‡æ ¹æ“šè¨­å®šçš„å¤©æ•¸ç”¢ç”Ÿç©º Day
                        return Array.from({ length: this.totalTripDays }, () => []);
                    }
                    
                    // 1. åˆå§‹åŒ–åˆ†çµ„é™£åˆ—
                    const dayGroups = Array.from({ length: this.totalTripDays }, () => []);

                    // 2. å°‡æ‰€æœ‰è¡Œç¨‹æ ¹æ“šå…¶ day å±¬æ€§æ”¾å…¥å°æ‡‰çš„ Day é™£åˆ—
                    this.activeTrip.itinerary.forEach(item => {
                        // ç¢ºä¿ item.day æ˜¯æœ‰æ•ˆæ•¸å­—ä¸”åœ¨ç¯„åœå…§ (1 åˆ° totalTripDays)
                        const dayIndex = (item.day || 1) - 1; 
                        if (dayIndex >= 0 && dayIndex < this.totalTripDays) {
                            dayGroups[dayIndex].push(item);
                        } else {
                            // å¦‚æœ Day æ•¸ç„¡æ•ˆï¼Œé è¨­æ”¾åœ¨ Day 1
                            dayGroups[0].push(item);
                        }
                    });
                    
                    // 3. é‡å°æ¯å€‹ Day å…§çš„è¡Œç¨‹ï¼ŒæŒ‰ç…§æ™‚é–“æ’åº
                    dayGroups.forEach(dayItems => {
                        dayItems.sort((a, b) => {
                            if (a.time < b.time) return -1;
                            if (a.time > b.time) return 1;
                            return 0;
                        });
                    });

                    return dayGroups;
                },
            },

            methods: {
                // === è³‡æ–™å„²å­˜èˆ‡è¼‰å…¥ ===
                saveData() {
                    localStorage.setItem('activeTripData', JSON.stringify({
                        ...this.activeTrip,
                        totalDays: this.totalTripDays // å„²å­˜ç¸½å¤©æ•¸
                    }));
                },

                loadData() {
                    const savedData = localStorage.getItem('activeTripData');
                    if (savedData) {
                        this.activeTripData = JSON.parse(savedData);
                        this.totalTripDays = this.activeTripData.totalDays || 3;
                        this.initializeItinerary();
                    } else {
                        // é è¨­/æ¨¡æ“¬è³‡æ–™
                        this.activeTripData = {
                            id: 1,
                            name: 'æ—¥æœ¬æ±äº¬äº”æ—¥éŠ',
                            itinerary: [
                                { id: 1, day: 1, time: '10:00', activity: 'æŠµé”æ±äº¬æˆç”°æ©Ÿå ´', mapLink: 'https://maps.app.goo.gl/kG7k82g4gQ8G3k318' },
                                { id: 2, day: 1, time: '12:00', activity: 'æ–°å®¿å¾¡è‹‘è³æ«»', mapLink: 'https://maps.app.goo.gl/wM2o3eW4sD6j4d4K6' },
                                { id: 3, day: 2, time: '09:00', activity: 'æ·ºè‰å¯ºåƒæ‹œ', mapLink: 'https://maps.app.goo.gl/9uG5zJp6pC7gD8pC7' },
                            ],
                        };
                        this.initializeItinerary();
                    }
                },
                
                // === è¡Œç¨‹ç®¡ç† ===
                // ç¢ºä¿è¡Œç¨‹è³‡æ–™æœ‰ ID å’Œ Day å±¬æ€§
                initializeItinerary() {
                    if (this.activeTripData && this.activeTripData.itinerary) {
                        this.activeTripData.itinerary = this.activeTripData.itinerary.map(item => {
                            if (!item.id) { item.id = nextItemId++; }
                            if (!item.day || item.day > this.totalTripDays) { item.day = 1; } // é è¨­ Day æ•¸ç‚º 1
                            return item;
                        });
                        // æ›´æ–° nextItemId
                        const maxId = this.activeTripData.itinerary.reduce((max, item) => Math.max(max, item.id), 0);
                        nextItemId = maxId + 1;
                        this.$nextTick(() => this.drawAllDayRoutes());
                    }
                },

                addItineraryItem() { 
                    this.activeTrip.itinerary.push({ 
                        id: nextItemId++, 
                        day: 1, // æ–°å¢é …ç›®é è¨­åœ¨ Day 1
                        time: '10:00', 
                        activity: '', 
                        mapLink: '' 
                    }); 
                    this.saveData(); 
                    this.reorganizeItinerary(); 
                },

                addItineraryItemToDay(dayNumber) {
                    this.activeTrip.itinerary.push({
                        id: nextItemId++,
                        day: dayNumber, 
                        time: '10:00',
                        activity: '',
                        mapLink: ''
                    });
                    this.saveData();
                    this.reorganizeItinerary();
                },
                
                removeItineraryItemByDay(dayIdx, itemId) {
                    if (confirm(`ç¢ºå®šè¦åˆªé™¤ Day ${dayIdx + 1} çš„æ­¤è¡Œç¨‹é …ç›®å—ï¼Ÿ`)) {
                        this.activeTrip.itinerary = this.activeTrip.itinerary.filter(item => item.id !== itemId);
                        this.saveData();
                        this.reorganizeItinerary();
                    }
                },

                // ğŸ¯ è§¸ç™¼ groupedItinerary é‡æ–°è¨ˆç®—å’Œåœ°åœ–é‡ç¹ª
                reorganizeItinerary() {
                    if (this.activeTab === 'itinerary-map') {
                         this.$nextTick(() => {
                            this.drawAllDayRoutes();
                         });
                    }
                },

                // ğŸ¯ æ‰¹æ¬¡åŒ¯å…¥
                runBatchImport() {
                    if(!this.batchImportText) return alert('è«‹è²¼ä¸Šå…§å®¹');
                    const lines = this.batchImportText.split('\n').filter(line => line.trim() !== '');
                    
                    const newItems = lines.map(line => {
                        const parts = line.split(',');
                        return {
                            id: nextItemId++,
                            day: 1, // é è¨­æ‰¹æ¬¡åŒ¯å…¥åˆ° Day 1
                            time: parts[0] ? parts[0].trim() : 'N/A',
                            activity: parts[1] ? parts[1].trim() : 'æ´»å‹•',
                            mapLink: parts[2] ? parts[2].trim() : ''
                        };
                    });
                    
                    this.activeTrip.itinerary.push(...newItems);
                    this.saveData();
                    this.showBatchImport = false;
                    this.batchImportText = '';
                    alert(`æˆåŠŸåŒ¯å…¥ ${newItems.length} æ¢è¡Œç¨‹ï¼è«‹è¨˜å¾—ç‚ºå®ƒå€‘è¨­å®šæ‰€å±¬çš„ Dayã€‚`);
                },

                // === åœ°åœ–ç›¸é—œæ–¹æ³• ===
                mapId(item, dayIdx, idx) { return `map-${dayIdx}-${idx}`; },

                async geocodeAddress(mapLink) {
                    if (!mapLink) return null;
                    
                    let match;
                    
                    // 1. Google Maps åº§æ¨™æ ¼å¼ (e.g., @35.6895,139.6917,15z)
                    if (mapLink.includes('@')) {
                        match = mapLink.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/);
                        if (match) {
                            return { lat: parseFloat(match[1]), lng: parseFloat(match[2]) };
                        }
                    }
                    
                    // 2. OpenStreetMap åº§æ¨™æ ¼å¼ (e.g., /#map=15/35.6895/139.6917)
                    if (mapLink.includes('/#map=')) {
                        match = mapLink.match(/\/#map=\d+\/(-?\d+\.\d+)\/(-?\d+\.\d+)/);
                        if (match) {
                            return { lat: parseFloat(match[1]), lng: parseFloat(match[2]) };
                        }
                    }
                    
                    return null;
                },

                async geocodeAndDrawRoute(dayIdx, items) {
                    const mapElementId = this.mapId(items[0], dayIdx, 0); 
                    const mapElement = document.getElementById(mapElementId);
                    
                    if (!mapElement || !this.dayVisibility[dayIdx]) return; // å¦‚æœ Day è¢«æ”¶åˆå‰‡ä¸ç¹ªè£½åœ°åœ–

                    // 1. åŸ·è¡Œ Geocoding
                    const geocodePromises = items.map(item => this.geocodeAddress(item.mapLink));
                    const routeCoordinates = (await Promise.all(geocodePromises))
                        .filter(coord => coord !== null)
                        .map(coord => [coord.lat, coord.lng]); 

                    // æ¸…é™¤èˆŠåœ°åœ– (å¦‚æœå­˜åœ¨)
                    if (this.dayMaps[dayIdx]) { 
                         this.dayMaps[dayIdx].off();
                         this.dayMaps[dayIdx].remove();
                         this.dayMaps[dayIdx] = null;
                    }

                    if (routeCoordinates.length === 0) { return; }

                    // 2. åœ°åœ–åˆå§‹åŒ–
                    let map = L.map(mapElementId, { zoomControl: false, scrollWheelZoom: 'center' })
                                .setView(routeCoordinates[0], 12);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                        maxZoom: 19,
                    }).addTo(map);
                    this.dayMaps[dayIdx] = map;
                    
                    // 3. ç¹ªè£½ Polyline (è·¯ç·š)
                    if (routeCoordinates.length > 1) {
                         const lineColor = this.polylineColors[dayIdx % this.polylineColors.length];
                         const polyline = L.polyline(routeCoordinates, {
                             color: lineColor, weight: 4, opacity: 0.8,
                         }).addTo(map);

                         this.dayPolylines[dayIdx] = polyline;
                    }
                    
                    // 4. æ–°å¢ Marker å’Œ Popup
                    routeCoordinates.forEach((coords, index) => {
                        const item = items.find(i => i.day === dayIdx + 1 && i.id === items[index].id);
                        L.marker(coords).addTo(map)
                            .bindPopup(`<b>${item ? item.activity : 'è¡Œç¨‹'}</b>`);
                    });

                    // 5. èª¿æ•´åœ°åœ–è¦–è§’ä»¥é¡¯ç¤ºæ‰€æœ‰é»
                    if (routeCoordinates.length > 1) {
                         map.fitBounds(map.fitBounds(L.latLngBounds(routeCoordinates), { padding: [10, 10] }));
                    } else {
                         map.setView(routeCoordinates[0], 14);
                    }
                },

                drawAllDayRoutes() {
                    // æ¸…é™¤æ‰€æœ‰èˆŠåœ°åœ–å¯¦ä¾‹
                    Object.values(this.dayMaps).forEach(map => {
                        if (map) { map.off(); map.remove(); }
                    });
                    this.dayMaps = {};
                    this.dayPolylines = {};
                    this.dayMarkers = {};
                    
                    // åªç‚ºå±•é–‹çš„ Day ç¹ªè£½
                    this.groupedItinerary.forEach((group, dayIdx) => {
                        if (group.length > 0 && this.dayVisibility[dayIdx]) {
                            this.geocodeAndDrawRoute(dayIdx, group);
                        }
                    });
                },
                
                openMapLink(item) {
                    if (item.mapLink && item.mapLink.startsWith('http')) {
                        window.open(item.mapLink, '_blank');
                    } else {
                        alert('è«‹è²¼ä¸Šæœ‰æ•ˆåœ°åœ–é€£çµ URL (å¿…é ˆåŒ…å« http æˆ– https)ã€‚');
                    }
                },

                // ğŸ¯ åˆ‡æ› Day çš„å±•é–‹ç‹€æ…‹
                toggleDayVisibility(dayIndex) {
                    // å¦‚æœè©² Day çš„ç‹€æ…‹ä¸å­˜åœ¨ï¼Œå‰‡é è¨­ç‚º false (æ”¶åˆ)
                    const current = this.dayVisibility[dayIndex] === undefined 
                                    ? false 
                                    : this.dayVisibility[dayIndex];
                    
                    // å±•é–‹/æ”¶åˆ (ä½¿ç”¨ $set ç¢ºä¿ Vue éŸ¿æ‡‰å¼æ›´æ–°)
                    this.$set(this.dayVisibility, dayIndex, !current); 
                    
                    // å¦‚æœæ˜¯å±•é–‹ï¼Œå¼·åˆ¶é‡ç¹ªåœ°åœ–
                    if (!current) {
                        this.$nextTick(() => {
                            this.drawAllDayRoutes();
                        });
                    }
                },
            },
            
            // === ç›£è½å™¨ ===
            watch: {
                activeTripData: {
                    handler(newTrip) {
                        if (newTrip) {
                            this.initializeItinerary();
                        }
                    },
                    immediate: true,
                    deep: true
                },
                // ğŸ¯ ç›£è½ç¸½æ—¥æ•¸è®Šæ›´
                totalTripDays(newVal) {
                     // ç¢ºä¿ Day 1 æ°¸é æ˜¯å±•é–‹çš„
                     if (newVal > 0) {
                         this.$set(this.dayVisibility, 0, true);
                     }
                     // ç§»é™¤è¶…å‡ºæ–°å¤©æ•¸ç¯„åœçš„ dayVisibility ç‹€æ…‹
                     Object.keys(this.dayVisibility).forEach(key => {
                         if (parseInt(key) >= newVal) {
                             delete this.dayVisibility[key];
                         }
                     });
                     this.saveData();
                     this.$nextTick(() => this.drawAllDayRoutes());
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
